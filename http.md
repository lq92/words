## HTTP
### TCP/IP协议族
    TCP/IP协议族按层次可以分为：应用层、传输层、网络层和数据链路层
      * 应用层——决定了向用户提供应用服务时通信的活动(FTP/DNS/HTTP)
      * 传输层——对上层应用层，提供处于网络连接中两台计算机之间的数据传输(TCP传输控制协议，UDP用户数据报协议)
      * 网络层——数据包是网络传输的最小单位，网络层用来处理网络上流动的数据包，该层规定了通过怎样的路径到达对方计算机，并将数据包传递给对方，与对方计算机之间通过多台计算机或网络设备进行传输时，网络层所起的作用就是在众多选项内选择一条传输路线
      * 数据链路层——用来处理连接网络的硬件部分，包含操作系统、硬件的设备驱动、网卡、光纤等物理可见部分
    在用TCP/IP协议族进行网络通信时，客户端从应用层往下走，服务器端从数据链路层往上走
    举例：首先作为发送端的客户端在应用层(HTTP协议)发出一个想看某个web页面的HTTP请求；接着为了传输方便，在传输层(TCP协议)把从应用层接收到的数据(HTTP请求报文)进行分割，并在报文上打上标记序号及端口号后转发给网络层；在网络层(IP协议)，增加作为通信目的地的MAC地址后转发给链路层，这样发往网络的通信请求就准备齐全了；服务器在链路层接收到数据，按顺序向上发送，一直到应用层，当到达应用层，才算真正接收由客户端发过来的HTTP请求 
### 确保可靠性的TCP协议
    TCP位于传输层，提供可靠的字节流服务(为了方便传输，将大块数据分割成以报文段为单位的数据包进行管理)，而可靠的传输服务是指，能够把数据准确可靠的传递给对方。总结起来，TCP协议为了能够传递大块数据所以把数据分割，而且会确认数据最终是否送达到对方
    TCP的三次握手：发送端首先会发送一个带SYN标志的数据包给对方，接收端接收后，回传一个带有SYN/ACK标志的数据包以示传达确认信息，最后发送方再回传一个带有ACK标志的数据包，代表结束。
### DNS——应用层协议
    用于域名到ip地址间的解析服务
### URI——统一资源标识符
    URI用字符串标识某一互联网资源，而URL表示资源的地点(互联网上所处的位置),URL是URI的子集
    URI格式：http://username:password@www.example.com:80/dir/index.html?uid=1#hash
### HTTP协议
    http协议规定：请求从客户端发出，服务器端接收响应并返回，请求都是从客户端开始建立通信，服务器端在没收到请求不会发送响应
        * 请求报文构成——请求的方法、请求的URI、HTTP版本号、可选的请求首部字段和内容实体构成
            ```
                POST / HTTP/1.1      // 方法、URI、HTTP协议
                // 请求首部字段
                Host: www.baidu.com
                Connection: keep-alive
                Content-Type: application/x-www-form-urlencoded
                Content-Length: 16
                // 内容实体
                name=ueno&age=37
            ```
        * 响应报文——由HTTP版本、处理请求的状态码和原因短语、响应的日期时间、资源实体的主体
            ```
                HTTP/1.1 200 OK
                // 响应首部字段
                Date: Tue, 10 jul 2018 08:00:00 GMT
                Content-Length: 362
                Content-Type: text/html
                CR + LF
                // 资源实体
                <html>
                .....
            ```
    http协议是无状态的协议，自身不对请求和响应之间的通信状态进行保存，协议对于发送过的请求或响应都不做持久化处理，但是为了实现保持状态功能，于是引入了Cookie技术，再加上HTTP协议通信，就可以管理状态了
    **HEAD方法**——和GET方法一样，只是不返回报文主体部分
    **OPTIONS方法**——用来查询针对请求URI指定的资源支持的方法
    **持久连接**——当请求一个HTML页面的同时也会请求该HTML页面里包含的其他资源，因此每次请求都会导致无谓的TCP连接建立和断开，增加通信量的开销，持久连接的特点是只要任意一端没有明确提出断开连接，则保持TCP连接状态
    **管线化**——持久连接使得多数请求以管线化方式发送成为可能，以前发送请求后需等待并收到响应，才发送下一个请求，管线化使得可以同时并行发送多个请求，而不需要一个接一个等待响应。
    **Cookie**——会根据从服务器端发送的响应报文内的一个叫Set-Cookie的首部字段信息，通知客户端保存Cookie，当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值后发送，服务器发现客户端发送过来的Cookie后，会检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息
        ```
            // 请求报文，没有Cookie信息
            GET / HTTP/1.1
            Host: www.taobao.com
            // 响应报文，SetCookie
            HTTP/1.1 200 OK
            Date: 
            Server: Apache
            <Set-Cookie: sid=1342077170226724; path=/; expires=Wed, 10-Oct-12 08:00:00 CMT>
            Content-Type: text/plain; charset=UTF-8
            // 请求报文(自动发送保存着的Cookie信息)
            GET / HTTP/1.1
            Host: www.taobao.com
            Cookie: sid=1342077170226724
        ```
### HTTP报文
    用于HTTP协议交互的信息被称为HTTP报文，客户端的HTTP报文叫请求报文，服务器端的叫响应报文。HTTP报文本身由多行(用CR+LF作换行符)数据构成的字符串文本。
    HTTP报文可分为报文首部和报文主体两部分，中间用CR+LF分割，报文主体可无
    报文首部：请求首部字段、响应首部字段、通用首部字段、实体首部字段
    **编码提升传输速率**
      HTTP在传输的时候可以原样传输也可以传输过程中通过编码提升传输速率，通过在传输时编码，能有效处理大量的访问请求，但是编码的操作需要计算机来完成，会消耗更多的CPU资源
      常用编码内容：gzip、compress、deflate、identity(不进行编码)
    ** 分块传输编码 **
      在HTTP通信过程中，请求的编码实体资源尚未全部传输完成之前，浏览器无法显示请求页面，在传输大容量数据时，通过把数据分割多块，能够让浏览器逐步显示页面
    ** 发送多种数据的多部分对象集合 **
      允许处理不同类型的数据。
      多部分对象集合包含的对象如下：
        `multipart/form-data`——在web表单文件上传时使用
        `multipart/byteranges`——状态码206，响应报文包含了多个范围的内容时使用
      在HTTP报文中使用多部分对象集合时，需在首部字段里加上Content-type
    ** 获取部分内容的范围请求 **
      使用范围请求，只请求部分字节内的资源，在请求首部字段指定Range
        `Range: bytes=5001-10000`
        `Range: bytes=5001-`
        `Range: bytes=-3000, 5000-7000` 从一开始到3000字节和5000-7000字节
      如何服务器无法响应范围请求，会返回200和完整的实体内容
    ** 内容协商返回最合适的内容 **
      同一个web网站有可能存在多份相同内容的页面，比如英语版和中文版，当浏览器默认语言为英语或中文，访问相同URI的web页面时，则会显示对应语言的web页面，这样的机制叫内容协商。
      内容协商会以响应资源的语言、字符集和编码方式等作为判断依据。
      包含在请求报文中的首部字段：
      Accept
      Accept-Charset
      Accept-Encoding
      Accept-Language
      Content-Language
      内容协商有以下3种类型：
        服务器驱动协商：以请求的首部字段为参考，在服务器端自动处理，对于用户来说，以浏览器发送的信息作为判定的依据，并不一定能筛选出最优内容。
        客户端驱动协商：由客户端进行内容协商的方式，用户从浏览器显示的可选项列表中手动选择，还可以利用js脚本在web页面上自动选择，比如按OS的类型和浏览器类型，自动切换成PC版页面或手机版页面。
        透明协商：是服务器驱动和客户端驱动的结合体，是由服务器端和客户端各自进行内容协商的一种方法。
### HTTP状态
    * 响应的状态码——数字中的第一位指定响应类别，后两位无分类
              类别|原因短句
          ----|----|----
          1xx|信息性状态码|接收的请求正在处理
          ----|----|----
          2xx|成功状态码|请求正常处理完毕
          ----|----|----
          3xx|重定向状态码|需要进行附加操作以完成请求
          ----|----|----
          4xx|客户端错误状态码|服务器无法处理请求
          ----|----|----
          5xx|服务器错误状态码|服务器处理请求出错
    * 常用状态码及说明
        200 OK 成功
        204 No Content：表示请求成功处理，但是响应报文中没有实体的主体内容
        206 Partial Content：表示客户端进行了范围请求(Range)，而服务器成功执行了这部分的GET请求，响应报文中包含由Content-Range指定范围的实体内容
        301 永久性重定向：表示请求的资源已被分配了新的URI，以后应使用资源现在所指的URI，如果对应的URI保存为书签了，这时应该按Location首部字段提示的URI重新保存
        302 临时性重定向：表示请求的资源已被分配了新的URI，希望用户本次能使用新的URI访问
        304 Not Modified：表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但未满足条件的情况，简单表达：客户端已经执行了GET，但文件未变化，附带条件请求指采用GET方法的请求报文中包含If-Match/If-Modified-Since/If-None-Match/If-Range/If-Unmodified-Since中任一首部
        400 表示请求报文中存在语法错误，当错误发生时，需修改请求的内容后再次发送请求
        401 未授权
        403 禁止访问资源，服务器端可以在响应的实体的主体部分中作出说明
        404 表示服务器上无法找到请求的资源
        500 表示服务器在执行请求时发生了错误，也可能是web应用存在bug或某些临时的故障
        503 表示服务器暂时处于超负载或正在进行停机维护，无法处理请求
### web服务器
    一台web服务器可以搭建多个独立域名的web网站，也可以作为通信路径上的中转服务器提升传输效率，通过虚拟主机的功能，可以假想已具有多台服务器。
    同时部署在同一个服务器上的不同域名，使用DNS服务解析域名后，两者的访问IP地址会相同
    ** 通信数据转发程序——代理、网关、隧道**
        HTTP通信时，除客户端和服务器外，还有一些用于通信数据转发的应用程序：代理、网关、隧道，用以配合服务器工作
        这些应用程序和服务器可以将请求转发给通信线路上的下一站服务器，并且能接收从那台服务器发送的响应再转发给客户端
        * 代理——有转发功能的应用程序，在客户端和服务器扮演中间人的角色，接收客户端发送的请求转发给服务器，同时也接收服务器返回的响应转发给客户端
            每次通过代理服务器转发请求或响应时，会追加写入Via首部信息
            理由：利用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要目的等
            缓存代理——转发响应时，缓存代理会预先将资源的副本保存在代理服务器上，当代理再次收到对相同资源的请求时，可以不从源服务器那里获取资源，而是将之前缓存的资源作为相应返回
            透明代理——转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理，反之称为非透明代理
        * 网关——转发其他服务器通信数据的服务器，接收客户端的请求时，就像自己拥有资源的源服务器一样对请求进行处理
            利用网关可以由HTTP请求转化为其他协议通信，利用网关能提高通信的安全性，因为可以在客户端和网关之间的通信线路上加密以确保连接的安全
        * 隧道——是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序
            隧道可按要求建立起一条与其他服务器的通信线路，可以使用SSL等加密手段进行通信，隧道的目的是确保客户端能与服务器进行安全的通信，隧道本身不会解析HTTP请求，隧道会在通信双方断开连接时结束
    ** 缓存 **
        指代理服务器或客户端本地磁盘内保存的资源副本，可以减少对源服务器的访问，节省了通信流量和通信时间，二次响应时会向源服务器确认缓存资源的有效性
### HTTP首部
    


